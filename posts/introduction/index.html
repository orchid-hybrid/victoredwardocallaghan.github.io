<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>Introduction - alt.folklore.things</title>
  <meta name="author" content="Edward O'Callaghan">
  <meta name="description" content="funfunctor">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/favicon.png" rel="shortcut icon">
  <link href='http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Merriweather:900italic,900,700italic,400italic,700,400,300italic,300' rel='stylesheet' type='text/css'>
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link href='/css/screen.css' rel='stylesheet' type='text/css' media='screen' />
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml" />
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src='/js/blaenk.js' type='text/javascript'></script>
</head>
<body>
  <div class="wrapper">
    <header id="header" class="inner">
      <div id="stamp">
        <h1><a href="/">alt.folklore.things</a></h1>
        <h4>Will this Eternal September ever end..</h4>
      </div>
      <nav id="main-nav">
        <ul class="main">
          <li><a href="/posts/">Posts</a></li>
          <li><a href="/notes/">Notes</a></li>
          <li><a href="/research/">Research</a></li>
          <li><a href="/about/">About</a></li>
          <li><a id="search_btn">Search</a></li>
        </ul>
      </nav>
      <nav id="mobile-nav">
        <div class="alignleft menu">
          <a class="button">Menu</a>
          <div class="container">
            <ul class="main">
              <li><a href="/posts/">Posts</a></li>
              <li><a href="/notes/">Notes</a></li>
              <li><a href="/research/">Research</a></li>
              <li><a href="/about/">About</a></li>
              <li><a id="search_btn">Search</a></li>
            </ul>
          </div>
        </div>
        <div class="alignright search">
          <a class="button"></a>
          <div class="container">
            <form action="http://google.com/search" method="get">
              <input type="text" name="q" results="0">
              <input type="hidden" name="q" value="site:alterapraxis.com">
            </form>
          </div>
        </div>
      </nav>
    </header>
    <div id="content" class="inner">
      <form class="desk_search" action="http://google.com/search" method="get">
        <input id="search" type="text" name="q" results="0" placeholder="Search" autocomplete="off" spellcheck="false">
        <input type="hidden" name="q" value="site:blaenkdenum.com">
      </form>
      <article class="post">
  <h2 class="title"><a href="/posts/introduction/"><span>Introduction</span></a></h2>
  <div class="entry-content"><nav id="toc" class="right-toc"><p>Contents</p><ol><li><a href="#file-structure">File Structure</a></li><li><a href="#hakyll">Hakyll</a><ol><li><a href="#abbreviations">Abbreviations</a></li><li><a href="#git-tag">Git Tag</a></li></ol></li><li><a href="#conclusion">Conclusion</a></li></ol></nav>
<p>Nothing major to say here</p>
<h2 id="file-structure">File Structure</h2>
<p>My <a href="https://github.com/victoredwardocallaghan">repositories</a></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Option</th>
<th style="text-align: left;">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">build</td>
<td style="text-align: left;">Generate the entire site</td>
</tr>
<tr class="even">
<td style="text-align: left;">deploy</td>
<td style="text-align: left;">Deploy the site using a custom deploy procedure</td>
</tr>
</tbody>
</table>
<p><strong>Build</strong> creates a top-level directory <strong>generated/</strong> with two sub-directories: a directory <strong>cache/</strong> for cached content and a directory <strong>site/</strong> where the compiled site is stored.</p>
<p><strong>Deploy</strong> puts the compiled site into top-level directory <strong>deploy/</strong> which is git-controlled and force pushes the content to the master branch, effectively deploying (on GitHub).</p>
<h2 id="hakyll">Hakyll</h2>
<p>For example, in the following Hakyll program:</p>
<figure class="codeblock"><pre><code class="highlight language-haskell"><span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="n">hakyll</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="n">match</span> <span class="s">&quot;images/*&quot;</span> <span class="o">$</span> <span class="kr">do</span>
      <span class="n">route</span>   <span class="n">idRoute</span>
      <span class="n">compile</span> <span class="n">copyFileCompiler</span>
</code></pre></figure>
<p><code>match &quot;images/*&quot;</code> is a <a href="http://hackage.haskell.org/packages/archive/hakyll/latest/doc/html/Hakyll-Core-Rules.html"><code>Rule</code></a> that states that the provider directory should match all files matching the glob <code>images/*</code>, <a href="http://hackage.haskell.org/packages/archive/hakyll/latest/doc/html/Hakyll-Core-Routes.html"><code>Route</code></a> them using the <code>idRoute</code>, and compile them using the <a href="http://hackage.haskell.org/packages/archive/hakyll/latest/doc/html/Hakyll-Core-Compiler.html"><code>Compiler</code></a> <code>copyFileCompiler</code>.</p>
<h3 id="abbreviations">Abbreviations</h3>
<h3 id="git-tag">Git Tag</h3>
<p>In a <a href="/posts/commit-tag-for-jekyll/">previous post</a> I talked about a liquid tag I created for Jekyll which inserts the SHA of the commit on which the site was last generated. I have come to like this small feature of my site. It’s not some tacky “Powered by blah” footer. It’s pretty unobtrusive. It seems unimportant to people who wouldn’t understand what it’s about, and those who would understand it might immediately recognize its purpose.</p>
<div class="callout">
<strong>Update</strong>: I have stopped including the git commit in the footer of every page. The problem with doing this was that, in order to have every page reflect the new commit, I had to regenerate every page before deploy. This obviously doesn’t scale well once more and more pages are added to the site. Instead I have adopted a per-post commit and history link which I believe is a lot more meaningful and meshes perfectly well with generation of pages, i.e. if a post is modified, there’ll be a commit made for it and since it was modified it will have to be regenerated anyways. Now I simply include social links in the footer.
</div>
<p>One thing I forgot to update the previous post about was that I ended up switching from using the Rugged git-bindings for Ruby to just using straight up commands and reading their output. The reason for doing this was that, while everything worked perfectly fine on Linux, Rugged had problems building on Windows. It turned out that taking this approach ended up being simpler and had the added benefit of decreasing my dependencies.</p>
<p>The equivalent of a liquid tag in Jekyll would be a field, expressed as a <code>Context</code>. For this reason I created the <code>gitTag</code> function that takes a desired key, such as <code>git</code> — which would be used as <code>$git$</code> in templates — and returns a <code>Context</code> which returns the <code>String</code> of formatted HTML. One problem was that to do this I had to use <code>IO</code>, so I needed some way to escape the <code>Compiler</code> Monad. It turned out that Hakyll already had a function for something like this called <code>unsafeCompiler</code>, which it uses for <code>UnixFilter</code> for example.</p>
<p>Here’s what <code>gitTag</code> looks like:</p>
<figure class="codeblock"><pre><code class="highlight language-haskell"><span class="nf">gitTag</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Context</span> <span class="kt">String</span>
<span class="nf">gitTag</span> <span class="n">key</span> <span class="ow">=</span> <span class="n">field</span> <span class="n">key</span> <span class="o">$</span> <span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kr">do</span>
  <span class="n">unsafeCompiler</span> <span class="o">$</span> <span class="kr">do</span>
    <span class="n">sha</span> <span class="ow">&lt;-</span> <span class="n">readProcess</span> <span class="s">&quot;git&quot;</span> <span class="p">[</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="s">&quot;-1&quot;</span><span class="p">,</span> <span class="s">&quot;HEAD&quot;</span><span class="p">,</span> <span class="s">&quot;--pretty=format:%H&quot;</span><span class="p">]</span> <span class="kt">[]</span>
    <span class="n">message</span> <span class="ow">&lt;-</span> <span class="n">readProcess</span> <span class="s">&quot;git&quot;</span> <span class="p">[</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="s">&quot;-1&quot;</span><span class="p">,</span> <span class="s">&quot;HEAD&quot;</span><span class="p">,</span> <span class="s">&quot;--pretty=format:%s&quot;</span><span class="p">]</span> <span class="kt">[]</span>
    <span class="n">return</span> <span class="p">(</span><span class="s">&quot;&lt;a href=</span><span class="se">\&quot;</span><span class="s">https://github.com/blaenk/blaenk.github.io/commit/&quot;</span> <span class="o">++</span> <span class="n">sha</span> <span class="o">++</span>
           <span class="s">&quot;</span><span class="se">\&quot;</span><span class="s"> title=</span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="o">++</span> <span class="n">message</span> <span class="o">++</span> <span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">&gt;&quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">take</span> <span class="mi">8</span> <span class="n">sha</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot;&lt;/a&gt;&quot;</span><span class="p">)</span>
</code></pre></figure>
<h2 id="conclusion">Conclusion</h2>
<p>..</p></div>
  <div class="meta">
    <div class="meta-component"><i class="fa fa-calendar fa-fw"></i> May  4, 2014</div>
    <div class="meta-component"><i class="fa fa-code-fork fa-fw"></i> <a href="https://github.com/victoredwardocallaghan/victoredwardocallagan.github.io/commits/source/provider/posts/introduction.markdown">History</a><span class="hash">, <a href="https://github.com/victoredwardocallaghan/victoredwardocallagan.github.io/commit/59f9c24" title="Initial">59f9c24</a></span></div>
    <div class="meta-component"><i class="fa fa-tags fa-fw"></i> <a href="/tags/hakyll/">Hakyll</a>, <a href="/tags/haskell/">Haskell</a>, <a href="/tags/pandoc/">Pandoc</a></div>
    
  </div>
</article>
<section id="comment">
  <div id="disqus_thread" aria-live="polite">
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



    </div>
    <footer id="footer" class="inner">
      <div id="social">
        <a href="https://github.com/victoredwardocallaghan" title="github"><i class="fa fa-github-alt"></i></a>
        &middot;
        <a href="http://stackoverflow.com/users/xxxyyy/funfunctor" title="stackoverflow"><i class="fa fa-stack-overflow"></i></a>
        &middot;
        <a href="mailto:eocallaghan@alterapraxis.com" title="email"><i class="fa fa-envelope"></i></a>
        &middot;
        <a href="/atom.xml" title="feed"><i class="fa fa-rss-square"></i></a>
      </div>
    </footer>
    
    <!-- disqus -->
<script async="true" type="text/javascript">
  var disqus_shortname = 'altfolklorethings';
  var disqus_identifier = 'http://victoredwardocallaghan.github.io/posts/introduction/';
  var disqus_url = 'http://victoredwardocallaghan.github.io/posts/introduction/';
  var disqus_script = 'embed.js';

  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());

  jQuery(function (){
    jQuery(window).bind('orientationchange', function() {
      DISQUS.reset({
        reload: true,
        config: function() {
          this.page.identifier = 'http://victoredwardocallaghan.github.io/posts/introduction/'
          this.page.url = 'http://victoredwardocallaghan.github.io/posts/introduction/'
        }
      });
    });
  });
</script>

    <!--MathJax CDN-->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        messageStyle: "none"
      });

      MathJax.Hub.Register.MessageHook('End Process', function() {
        jQuery('#MathJax_Font_Test').empty();
        jQuery('.MathJax_Display').parent('.math').addClass('mobile-math');
      });
    </script>
    <script async="true" type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
    </script>
  </div>
</body>
</html>
